

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>bipo.pipelines.feature_engineering.pipeline &#8212; BIPO Demand Forecasting v1.0.0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../../_static/styles/theme.css?digest=ac02cc09edc035673794" rel="stylesheet" />
<link href="../../../../_static/styles/bootstrap.css?digest=ac02cc09edc035673794" rel="stylesheet" />
<link href="../../../../_static/styles/pydata-sphinx-theme.css?digest=ac02cc09edc035673794" rel="stylesheet" />

  
  <link href="../../../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=ac02cc09edc035673794" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../../_static/scripts/bootstrap.js?digest=ac02cc09edc035673794" />
<link rel="preload" as="script" href="../../../../_static/scripts/pydata-sphinx-theme.js?digest=ac02cc09edc035673794" />
  <script src="../../../../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=ac02cc09edc035673794"></script>

    <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/sphinx_highlight.js"></script>
    <script src="../../../../_static/clipboard.min.js"></script>
    <script src="../../../../_static/copybutton.js"></script>
    <script src="../../../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/bipo/pipelines/feature_engineering/pipeline';</script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../../../../index.html">
  
  
  
  
  
    <p class="title logo__title">BIPO Demand Forecasting v1.0.0 documentation</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../../overview.html">Project Overview</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Setup</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../../inference-deployment-env-setup.html">Deployment Environment Setup - Inference Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../training-deployment-env-setup.html">Deployment Environment Setup - Training Module</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Data Pipeline</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../../kedro-overview.html">Overview of Kedro (v0.18.11)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../data-pipeline.html">Data Pipeline</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Model Training</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../../training-pipeline.html">Training Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../experiment-tracking.html">Experiment Tracking</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Model Serving</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../../inference-endpoint.html">Model Serving Endpoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../inference-module.html">Inference Module</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Supplementary Guides</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../../faq.html">FAQ</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../modules.html">bipo</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../bipo.html">bipo package</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../bipo.pipelines.html">bipo.pipelines package</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../bipo.pipelines.data_loader.html">bipo.pipelines.data_loader package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../bipo.pipelines.data_merge.html">bipo.pipelines.data_merge package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../bipo.pipelines.data_preprocessing.html">bipo.pipelines.data_preprocessing package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../bipo.pipelines.data_split.html">bipo.pipelines.data_split package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../bipo.pipelines.feature_engineering.html">bipo.pipelines.feature_engineering package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../bipo.pipelines.model_evaluation.html">bipo.pipelines.model_evaluation package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../bipo.pipelines.model_specific_preprocessing.html">bipo.pipelines.model_specific_preprocessing package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../bipo.pipelines.model_training.html">bipo.pipelines.model_training package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../bipo.pipelines.time_agnostic_feature_engineering.html">bipo.pipelines.time_agnostic_feature_engineering package</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../bipo_fastapi.html">bipo_fastapi package</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../tests.html">tests package</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../tests.pipelines.html">tests.pipelines package</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../tests.pipelines.data_loader.html">tests.pipelines.data_loader package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../tests.pipelines.data_preprocessing.html">tests.pipelines.data_preprocessing package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../tests.pipelines.feature_engineering.html">tests.pipelines.feature_engineering package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../tests.pipelines.pre_feature_engineering.html">tests.pipelines.pre_feature_engineering package</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">



<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>

</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1></h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <h1>Source code for bipo.pipelines.feature_engineering.pipeline</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">kedro.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span><span class="p">,</span> <span class="n">node</span>
<span class="kn">from</span> <span class="nn">kedro.pipeline.modular_pipeline</span> <span class="kn">import</span> <span class="n">pipeline</span>

<span class="kn">from</span> <span class="nn">bipo</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">kedro.config</span> <span class="kn">import</span> <span class="n">ConfigLoader</span>

<span class="c1"># Lag feature processes</span>
<span class="kn">from</span> <span class="nn">.lag_feature_generation</span> <span class="kn">import</span> <span class="n">merge_fold_and_generated_lag</span>

<span class="c1"># Lightweightmmm processes</span>
<span class="kn">from</span> <span class="nn">.lightweightmmm</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">extract_mmm_params_for_folds</span><span class="p">,</span>
    <span class="n">generate_mmm_features_for_outlets</span><span class="p">,</span>
    <span class="n">merge_mmm_features_with_fold_outlets</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># General feature engineering processes</span>
<span class="kn">from</span> <span class="nn">.nodes</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">generate_lag</span><span class="p">,</span>
    <span class="n">apply_feature_encoding_transform</span><span class="p">,</span>
    <span class="n">apply_feature_encoding_fit</span><span class="p">,</span>
    <span class="n">apply_standard_norm_fit</span><span class="p">,</span>
    <span class="n">apply_standard_norm_transform</span><span class="p">,</span>
    <span class="n">apply_binning_fit</span><span class="p">,</span>
    <span class="n">apply_binning_transform</span><span class="p">,</span>
    <span class="n">concat_same_folds_of_outlet_data</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># tsfresh processes</span>

<span class="kn">from</span> <span class="nn">.tsfresh_node</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">run_tsfresh_feature_selection_process</span><span class="p">,</span>
    <span class="n">run_tsfresh_feature_engineering_process</span><span class="p">,</span>
    <span class="n">merge_tsfresh_features_with_outlets</span><span class="p">,</span>
<span class="p">)</span>


<div class="viewcode-block" id="create_pipeline"><a class="viewcode-back" href="../../../../bipo.pipelines.feature_engineering.html#bipo.pipelines.feature_engineering.pipeline.create_pipeline">[docs]</a><span class="k">def</span> <span class="nf">create_pipeline</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Pipeline</span><span class="p">:</span>
    <span class="n">conf_loader</span> <span class="o">=</span> <span class="n">ConfigLoader</span><span class="p">(</span><span class="n">conf_source</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">CONF_SOURCE</span><span class="p">)</span>
    <span class="n">conf_params</span> <span class="o">=</span> <span class="n">conf_loader</span><span class="p">[</span><span class="s2">&quot;parameters&quot;</span><span class="p">]</span>

    <span class="n">feature_engineering_pipeline_instance</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="c1">## Binning nodes</span>
            <span class="n">node</span><span class="p">(</span>
                <span class="n">func</span><span class="o">=</span><span class="n">apply_binning_fit</span><span class="p">,</span>
                <span class="n">inputs</span><span class="o">=</span><span class="p">[</span>
                    <span class="s2">&quot;time_agnostic_feature_engineering_training&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;parameters&quot;</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="n">outputs</span><span class="o">=</span><span class="s2">&quot;binning_encodings_dict&quot;</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;feature_engr_apply_binning_fit&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">node</span><span class="p">(</span>
                <span class="n">func</span><span class="o">=</span><span class="n">apply_binning_transform</span><span class="p">,</span>
                <span class="n">inputs</span><span class="o">=</span><span class="p">[</span>
                    <span class="s2">&quot;time_agnostic_feature_engineering_training&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;parameters&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;binning_encodings_dict&quot;</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="n">outputs</span><span class="o">=</span><span class="s2">&quot;equal_freq_binning_fit_training&quot;</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;feature_engr_apply_binning_transform_training&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">node</span><span class="p">(</span>  <span class="c1"># Handles validation set</span>
                <span class="n">func</span><span class="o">=</span><span class="n">apply_binning_transform</span><span class="p">,</span>
                <span class="n">inputs</span><span class="o">=</span><span class="p">[</span>
                    <span class="s2">&quot;time_agnostic_feature_engineering_validation&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;parameters&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;binning_encodings_dict&quot;</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="n">outputs</span><span class="o">=</span><span class="s2">&quot;equal_freq_binning_fit_validation&quot;</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;feature_engr_apply_binning_transform_val&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="c1">## Standardisation/Normalisation nodes.</span>
            <span class="n">node</span><span class="p">(</span>
                <span class="n">func</span><span class="o">=</span><span class="n">apply_standard_norm_fit</span><span class="p">,</span>
                <span class="n">inputs</span><span class="o">=</span><span class="p">[</span>
                    <span class="s2">&quot;equal_freq_binning_fit_training&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;parameters&quot;</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="n">outputs</span><span class="o">=</span><span class="s2">&quot;std_norm_encoding_dict&quot;</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;feature_engr_apply_standard_norm_fit&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">node</span><span class="p">(</span>
                <span class="n">func</span><span class="o">=</span><span class="n">apply_standard_norm_transform</span><span class="p">,</span>
                <span class="n">inputs</span><span class="o">=</span><span class="p">[</span>
                    <span class="s2">&quot;equal_freq_binning_fit_training&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;parameters&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;std_norm_encoding_dict&quot;</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="n">outputs</span><span class="o">=</span><span class="s2">&quot;feature_engineering_training&quot;</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;feature_engr_apply_standard_norm_transform_training&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">node</span><span class="p">(</span>
                <span class="n">func</span><span class="o">=</span><span class="n">apply_standard_norm_transform</span><span class="p">,</span>
                <span class="n">inputs</span><span class="o">=</span><span class="p">[</span>
                    <span class="s2">&quot;equal_freq_binning_fit_validation&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;parameters&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;std_norm_encoding_dict&quot;</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="n">outputs</span><span class="o">=</span><span class="s2">&quot;feature_engineering_validation&quot;</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;feature_engr_apply_standard_norm_transform_val&quot;</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">],</span>
        <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;cleanup&quot;</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="c1"># Pipeline for generating lightweightmmmm features only. Input continues off the last node of feature_engineering_pipeline_instance</span>
    <span class="n">lightweight_mmm_pipeline</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">node</span><span class="p">(</span>
                <span class="n">func</span><span class="o">=</span><span class="n">extract_mmm_params_for_folds</span><span class="p">,</span>
                <span class="n">inputs</span><span class="o">=</span><span class="p">[</span>
                    <span class="s2">&quot;feature_engineering_training&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;parameters&quot;</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="n">outputs</span><span class="o">=</span><span class="s2">&quot;lightweightmmm_fitted_params&quot;</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;feature_engr_extract_mmm_params_for_folds&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">node</span><span class="p">(</span>
                <span class="n">func</span><span class="o">=</span><span class="n">generate_mmm_features_for_outlets</span><span class="p">,</span>
                <span class="n">inputs</span><span class="o">=</span><span class="p">[</span>
                    <span class="s2">&quot;lightweightmmm_fitted_params&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;feature_engineering_training&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;parameters&quot;</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="n">outputs</span><span class="o">=</span><span class="s2">&quot;lightweightmmm_features_training&quot;</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;feature_engr_generate_mmm_features_for_outlets_training&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">node</span><span class="p">(</span>
                <span class="n">func</span><span class="o">=</span><span class="n">generate_mmm_features_for_outlets</span><span class="p">,</span>
                <span class="n">inputs</span><span class="o">=</span><span class="p">[</span>
                    <span class="s2">&quot;lightweightmmm_fitted_params&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;feature_engineering_validation&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;parameters&quot;</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="n">outputs</span><span class="o">=</span><span class="s2">&quot;lightweightmmm_features_validation&quot;</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;feature_engr_generate_mmm_features_for_outlets_val&quot;</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">],</span>
    <span class="p">)</span>

    <span class="c1"># Pipeline for generating tsfresh derived features only. Input continues off the last node of feature_engineering_pipeline_instance</span>
    <span class="n">tsfresh_pipeline</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">node</span><span class="p">(</span>
                <span class="n">func</span><span class="o">=</span><span class="n">run_tsfresh_feature_selection_process</span><span class="p">,</span>
                <span class="n">inputs</span><span class="o">=</span><span class="p">[</span>
                    <span class="s2">&quot;feature_engineering_training&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;parameters&quot;</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="n">outputs</span><span class="o">=</span><span class="s2">&quot;tsfresh_fitted_params&quot;</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;feature_engr_tsfresh_feature_selection_process&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">node</span><span class="p">(</span>
                <span class="n">func</span><span class="o">=</span><span class="n">run_tsfresh_feature_engineering_process</span><span class="p">,</span>
                <span class="n">inputs</span><span class="o">=</span><span class="p">[</span>
                    <span class="s2">&quot;tsfresh_fitted_params&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;feature_engineering_training&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;parameters&quot;</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="n">outputs</span><span class="o">=</span><span class="s2">&quot;tsfresh_features_training&quot;</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;feature_engr_run_tsfresh_feature_engineering_process_train&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">node</span><span class="p">(</span>
                <span class="n">func</span><span class="o">=</span><span class="n">run_tsfresh_feature_engineering_process</span><span class="p">,</span>
                <span class="n">inputs</span><span class="o">=</span><span class="p">[</span>
                    <span class="s2">&quot;tsfresh_fitted_params&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;feature_engineering_validation&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;parameters&quot;</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="n">outputs</span><span class="o">=</span><span class="s2">&quot;tsfresh_features_validation&quot;</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;feature_engr_run_tsfresh_feature_engineering_process_val&quot;</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">],</span>
    <span class="p">)</span>

    <span class="c1"># Pipeline for generating lag features pipeline. No dependency on any past nodes in feature engineering but based on proxy revenue data partitioned into outlets in 02_dataloader</span>
    <span class="n">lag_generation_pipeline</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">node</span><span class="p">(</span>
                <span class="n">func</span><span class="o">=</span><span class="n">generate_lag</span><span class="p">,</span>
                <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;loaded_proxy_revenue_partitioned_data&quot;</span><span class="p">,</span> <span class="s2">&quot;parameters&quot;</span><span class="p">],</span>
                <span class="n">outputs</span><span class="o">=</span><span class="s2">&quot;lag_features_partitions_dict&quot;</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;feature_engr_generate_lag&quot;</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">],</span>
    <span class="p">)</span>

    <span class="c1"># Pipeline facilitating merging of lightweightMMM/tsfresh feature merging with outlet features.</span>
    <span class="n">merge_generated_features_pipeline</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="c1"># Merge mmm features and fold outlets</span>
            <span class="n">node</span><span class="p">(</span>
                <span class="n">func</span><span class="o">=</span><span class="n">merge_mmm_features_with_fold_outlets</span><span class="p">,</span>
                <span class="n">inputs</span><span class="o">=</span><span class="p">[</span>
                    <span class="s2">&quot;feature_engineering_training&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;lightweightmmm_features_training&quot;</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="n">outputs</span><span class="o">=</span><span class="s2">&quot;merged_lightweightmmm_training&quot;</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;feature_engr_merge_mmm_features_with_fold_outlets_training&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">node</span><span class="p">(</span>
                <span class="n">func</span><span class="o">=</span><span class="n">merge_mmm_features_with_fold_outlets</span><span class="p">,</span>
                <span class="n">inputs</span><span class="o">=</span><span class="p">[</span>
                    <span class="s2">&quot;feature_engineering_validation&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;lightweightmmm_features_validation&quot;</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="n">outputs</span><span class="o">=</span><span class="s2">&quot;merged_lightweightmmm_validation&quot;</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;feature_engr_merge_mmm_features_with_fold_outlets_validation&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="c1"># Tsfresh feature merging</span>
            <span class="n">node</span><span class="p">(</span>
                <span class="n">func</span><span class="o">=</span><span class="n">merge_tsfresh_features_with_outlets</span><span class="p">,</span>
                <span class="n">inputs</span><span class="o">=</span><span class="p">[</span>
                    <span class="s2">&quot;merged_lightweightmmm_training&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;tsfresh_features_training&quot;</span><span class="p">,</span>  <span class="c1"># From feature_engineering</span>
                <span class="p">],</span>
                <span class="n">outputs</span><span class="o">=</span><span class="s2">&quot;merged_tsfresh_features_training&quot;</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;feature_engr_merge_tsfresh_features_with_fold_outlets_training&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">node</span><span class="p">(</span>
                <span class="n">func</span><span class="o">=</span><span class="n">merge_tsfresh_features_with_outlets</span><span class="p">,</span>
                <span class="n">inputs</span><span class="o">=</span><span class="p">[</span>
                    <span class="s2">&quot;merged_lightweightmmm_validation&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;tsfresh_features_validation&quot;</span><span class="p">,</span>  <span class="c1"># From feature_engineering</span>
                <span class="p">],</span>
                <span class="n">outputs</span><span class="o">=</span><span class="s2">&quot;merged_tsfresh_features_validation&quot;</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;feature_engr_merge_tsfresh_features_with_fold_outlets_validation&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="c1"># Lag features merging</span>
            <span class="n">node</span><span class="p">(</span>
                <span class="n">func</span><span class="o">=</span><span class="n">merge_fold_and_generated_lag</span><span class="p">,</span>
                <span class="n">inputs</span><span class="o">=</span><span class="p">[</span>
                    <span class="s2">&quot;merged_tsfresh_features_training&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;lag_features_partitions_dict&quot;</span><span class="p">,</span>  <span class="c1"># From feature_engineering</span>
                <span class="p">],</span>
                <span class="n">outputs</span><span class="o">=</span><span class="s2">&quot;merged_lag_features_training&quot;</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;feature_engr_merge_fold_and_generated_lag_training&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">node</span><span class="p">(</span>
                <span class="n">func</span><span class="o">=</span><span class="n">merge_fold_and_generated_lag</span><span class="p">,</span>
                <span class="n">inputs</span><span class="o">=</span><span class="p">[</span>
                    <span class="s2">&quot;merged_tsfresh_features_validation&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;lag_features_partitions_dict&quot;</span><span class="p">,</span>  <span class="c1"># From feature_engineering</span>
                <span class="p">],</span>
                <span class="n">outputs</span><span class="o">=</span><span class="s2">&quot;merged_lag_features_validation&quot;</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;feature_engr_merge_fold_and_generated_lag_validation&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="c1"># Concatenate same data folds</span>
            <span class="n">node</span><span class="p">(</span>
                <span class="n">func</span><span class="o">=</span><span class="n">concat_same_folds_of_outlet_data</span><span class="p">,</span>
                <span class="n">inputs</span><span class="o">=</span><span class="s2">&quot;merged_lag_features_training&quot;</span><span class="p">,</span>
                <span class="n">outputs</span><span class="o">=</span><span class="s2">&quot;concatenated_folds_training&quot;</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;feature_engr_preprocess_concat_same_folds_of_outlet_data_train&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">node</span><span class="p">(</span>
                <span class="n">func</span><span class="o">=</span><span class="n">concat_same_folds_of_outlet_data</span><span class="p">,</span>
                <span class="n">inputs</span><span class="o">=</span><span class="s2">&quot;merged_lag_features_validation&quot;</span><span class="p">,</span>
                <span class="n">outputs</span><span class="o">=</span><span class="s2">&quot;concatenated_folds_validation&quot;</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;feature_engr_preprocess_concat_same_folds_of_outlet_data_val&quot;</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">],</span>
    <span class="p">)</span>

    <span class="c1"># Ordinal encoding pipeline</span>
    <span class="n">ordinal_encoding_pipeline</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">node</span><span class="p">(</span>
                <span class="n">func</span><span class="o">=</span><span class="n">apply_feature_encoding_fit</span><span class="p">,</span>
                <span class="n">inputs</span><span class="o">=</span><span class="p">[</span>
                    <span class="s2">&quot;concatenated_folds_training&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;parameters&quot;</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="n">outputs</span><span class="o">=</span><span class="s2">&quot;feature_encoding_dict&quot;</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;feature_engr_apply_feature_encoding_fit&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">node</span><span class="p">(</span>
                <span class="n">func</span><span class="o">=</span><span class="n">apply_feature_encoding_transform</span><span class="p">,</span>
                <span class="n">inputs</span><span class="o">=</span><span class="p">[</span>
                    <span class="s2">&quot;concatenated_folds_training&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;parameters&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;feature_encoding_dict&quot;</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="n">outputs</span><span class="o">=</span><span class="s2">&quot;merged_features_training&quot;</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;feature_engr_apply_feature_encoding_transform_train&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">node</span><span class="p">(</span>
                <span class="n">func</span><span class="o">=</span><span class="n">apply_feature_encoding_transform</span><span class="p">,</span>
                <span class="n">inputs</span><span class="o">=</span><span class="p">[</span>
                    <span class="s2">&quot;concatenated_folds_validation&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;parameters&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;feature_encoding_dict&quot;</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="n">outputs</span><span class="o">=</span><span class="s2">&quot;merged_features_validation&quot;</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;feature_engr_apply_feature_encoding_transform_val&quot;</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">]</span>
    <span class="p">)</span>

    <span class="c1"># Extend pipeline based on togglable configuration enabling/disabling lightweightmmm and tsfresh.</span>
    <span class="k">if</span> <span class="n">conf_params</span><span class="p">[</span><span class="s2">&quot;include_lightweightMMM&quot;</span><span class="p">]:</span>
        <span class="n">feature_engineering_pipeline_instance</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">feature_engineering_pipeline_instance</span> <span class="o">+</span> <span class="n">lightweight_mmm_pipeline</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">conf_params</span><span class="p">[</span><span class="s2">&quot;include_tsfresh&quot;</span><span class="p">]:</span>
        <span class="n">feature_engineering_pipeline_instance</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">feature_engineering_pipeline_instance</span> <span class="o">+</span> <span class="n">tsfresh_pipeline</span>
        <span class="p">)</span>

    <span class="c1"># Extend existing pipeline with lag generation pipeline, merge generated features and ordinal encoding pipeline. Reason for putting ordinal encoding pipeline as the last is due to the fact that existing categorical data features are applicable across outlets and not specific to unique outlets.</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">feature_engineering_pipeline_instance</span>
        <span class="o">+</span> <span class="n">lag_generation_pipeline</span>
        <span class="o">+</span> <span class="n">merge_generated_features_pipeline</span>
        <span class="o">+</span> <span class="n">ordinal_encoding_pipeline</span>
    <span class="p">)</span></div>
</pre></div>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By AI Singapore
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2023, AI Singapore.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../../_static/scripts/bootstrap.js?digest=ac02cc09edc035673794"></script>
<script src="../../../../_static/scripts/pydata-sphinx-theme.js?digest=ac02cc09edc035673794"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>